# 水质数据智能处理指南

## 数据质量分析结果

基于你的水质数据分析，发现以下关键问题：

### 数据质量状况
- **缺失率极高**: 76-83%的数据缺失
- **连续缺失严重**: 最大连续缺失303-2407个数据点
- **数据稀疏**: 有效数据仅占17-24%

### 各数据集具体情况
| 数据集 | 缺失率 | 最大连续缺失 | 数据点总数 | 有效数据点 |
|--------|--------|--------------|------------|------------|
| WLSQ   | 81.0%  | 1479         | 39,897     | ~7,600     |
| XFZ    | 83.4%  | 2407         | 39,897     | ~6,600     |
| XP     | 80.0%  | 1675         | 36,085     | ~7,200     |
| XYTQ   | 79.2%  | 911          | 39,897     | ~8,200     |
| WJB    | 76.2%  | 303          | 14,325     | ~3,400     |
| TGDQ   | 77.4%  | 339          | 7,249      | ~1,600     |
| SWD    | 79.0%  | 1411         | 14,337     | ~3,000     |

## 处理策略

### 1. 保守策略 (Conservative) - 推荐用于模型训练
**特点:**
- 删除连续缺失超过50个数据点的时间段
- 使用KNN插值处理剩余缺失值
- 保留约60-70%的原始数据
- 数据质量较高，适合机器学习

**适用场景:**
- 时间序列预测模型训练
- 需要保持数据连续性的分析
- 对数据质量要求较高的应用

### 2. 激进策略 (Aggressive) - 推荐用于数据清洗
**特点:**
- 删除连续缺失超过30个数据点的时间段
- 严格异常值检测和处理
- 保留约40-50%的原始数据
- 数据质量最高，但数据量较少

**适用场景:**
- 数据质量控制和清洗
- 需要高质量数据的分析
- 对数据完整性要求不高的应用

### 3. 分段策略 (Segmented) - 推荐用于时间序列分析
**特点:**
- 删除连续缺失超过100个数据点的时间段
- 对每个时间段单独处理
- 保留约80-90%的原始数据
- 保持时间序列的完整性

**适用场景:**
- 时间序列趋势分析
- 季节性模式研究
- 需要保持时间连续性的应用

## 使用方法

### 方法1: 批量处理所有数据集
```bash
cd <project_root>
python scripts/data_preparation/batch_process_water_quality.py
```

### 方法2: 处理单个数据集
```bash
# 保守策略
python scripts/data_preparation/smart_water_quality_processor.py --input WH/XFZ.csv --output WH_processed/XFZ_conservative.csv --strategy conservative

# 激进策略
python scripts/data_preparation/smart_water_quality_processor.py --input WH/XFZ.csv --output WH_processed/XFZ_aggressive.csv --strategy aggressive

# 分段策略
python scripts/data_preparation/smart_water_quality_processor.py --input WH/XFZ.csv --output WH_processed/XFZ_segmented.csv --strategy segmented
```

## 处理流程

1. **数据加载**: 自动检测文件编码并加载数据
2. **缺失值分析**: 分析连续缺失模式
3. **时间段删除**: 根据策略删除长时间连续缺失的时间段
4. **异常值处理**: 检测并处理异常值
5. **插值处理**: 使用高级插值方法填充缺失值
6. **数据格式化**: 设置合适的小数位数
7. **结果保存**: 保存处理后的数据

## 输出文件

处理后的文件将保存在 `WH_processed/` 目录下，命名格式为：
- `{数据集名}_{策略}.csv`

例如：
- `XFZ_conservative.csv` - XFZ数据集的保守处理结果
- `WLSQ_aggressive.csv` - WLSQ数据集的激进处理结果
- `XP_segmented.csv` - XP数据集的分段处理结果

## 建议

基于你的数据质量分析，我建议：

1. **优先使用保守策略**进行模型训练，因为它在数据质量和数量之间取得了良好平衡
2. **使用激进策略**进行数据质量评估和清洗
3. **使用分段策略**进行时间序列分析和趋势研究

每种策略都会生成详细的处理日志，包括数据保留率、最终缺失率等信息，帮助你选择最适合的策略。